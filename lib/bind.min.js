var Bind=function e(t){"use strict";function n(e){return(e+"").replace(/[<>]/g,function(e){return{">":"&gt;","<":"&lt;"}[e]})}function r(e,t){for(var n=e.length,r=0;n>r;r++)t(e[r],r,e)}function i(e,t){var n="pop push reverse shift sort splice unshift".split(" ");r(n,function(n){this[n]=function(){this.__dirty=!0;var r=c({},u[n].apply(this,arguments));return delete this.__dirty,e&&t.ready&&e(this),r}.bind(this)}.bind(this));var i=this.length;return Object.defineProperty(this,"length",{configurable:!1,enumerable:!0,set:function(e){if(this.__dirty)return void(i=e);var t=1*e;return i!==t&&(t>i?this.push.apply(this,new Array(t-i)):this.splice(t),i=t),e},get:function(){return i}}),this}function a(e,t,s,u){return u||(u=[]),s.ready&&t.__callback?e:(r(Object.getOwnPropertyNames(t),function(y){if("__callback"!==y){var v,b=t[y],_=[].slice.call(u),g=function(e){return n(e)},k=p;_.push(y);var m=s.mapping[_.join(".")];if(m&&"[object Object]"===m.toString()&&(m.callback&&(v=m.callback),m.transform&&(g=d(m.transform.bind({safe:n}))),m.parse&&(k=d(m.parse)),m=m.dom),"function"==typeof m)v=m;else if("string"==typeof m){var O=o(m||"☺");0===O.length&&console.warn('No elements found against "'+m+'" selector');var j=["SELECT","INPUT","PROGRESS"],A=v;v=function(t){O=o(m||"☺"),O&&r(O,function(e){if(!e.__dirty)if(-1!==j.indexOf(e.nodeName)){var n=g(t);if("checkbox"===e.type){if(t instanceof Array){var i=t.filter(function(t){return t===e.value?(e.checked=e.value===t,!0):void 0});0===i.length&&(e.checked=!1)}}else if("radio"===e.type)e.checked=e.value===n;else if("number"==typeof e.value)try{e.value=1*n}catch(a){console.error(a.message)}else e.value=n}else{t instanceof Array||(t=[t]);var c="";r(t,function(e){c+=g(e)}),e.innerHTML=c}}),A&&A.apply(e,arguments)},r(O,function(t){if("INPUT"===t.nodeName||"SELECT"===t.nodeName){var n=function(){this.__dirty=!0;var n;if("checkbox"===t.type){var i=(t.form||document).querySelectorAll('input[name="'+t.name+'"][type="'+t.type+'"]');if(e[y]instanceof Array){var a=[];r(i,function(e){e.checked&&a.push(k(e.value))}),n=a}else n=this.checked?k(this.value):null}else"radio"===t.type&&(n=this.checked?k(this.value):null),n=k("number"==typeof e[y]?1*this.value:this.value);void 0===n&&(n=this.value),e[y]=n,this.__dirty=!1},i={checkbox:"change",radio:"change"}[t.type];t.addEventListener(i||"input",n)}})}v&&_.reduce(function(e,t,n,r){return e[t]||(e[t]={}),n===r.length-1&&(e[t].__callback=v),e[t]},s.callbacks);var N=function(e){var t=[],n=[],r=s.instance,i=!1,a=!1;if(l&&console.log("> finding callback for %s",y,_),_.reduce(function(o,l,s){if(o&&o[l]&&l){if(r=r[l],"function"==typeof o[l].__callback){var u=s===_.length-1?e:r;r.__dirty&&(i=!0),s===_.length-1&&o[l].__callback&&(a={path:_.join("."),callback:o[l].__callback,instance:u}),i||(n.push(c(u instanceof Array?[]:{},u)),t.push(o[l].__callback))}return o[l]||{}}},s.callbacks),i||(n.reverse(),t.reverse().forEach(function(e,t){e.call(s.instance,n[t])})),i&&a){var r=a.instance;a.callback.call(s.instance,c(r instanceof Array?[]:{},r))}},P={configurable:!0,enumerable:!0,set:function(t){var n=b!==t?b:void 0;b=!s.ready||typeof t!==h||null===t||f(t)||t.__callback?f(t)?a(new i(N,s),t,s,_):t:a(e[y]?c({},e[y]):{},t,s,_),l&&console.log("set: key(%s): %s -> %s",y,JSON.stringify(n),JSON.stringify(t)),s.ready?N(b):s.deferred.push(N.bind(e,b,n))},get:function(){return b}};try{Object.defineProperty(e,y,P)}catch(w){}typeof b!==h||null===b||f(b)?f(b)?e[y]=a(new i(N,s),b,s,_):e instanceof i||(e[y]=b):e[y]=a(e[y]||{},b,s,_)}}),e instanceof i&&e.push.apply(e,t),e)}function c(t,n){return n instanceof Object?(r(Object.getOwnPropertyNames(n),function(r){var i=n[r];e.prototype[r]||"__callback"===r||(typeof i===h&&null!==i&&i instanceof Array?t[r]=[].map.call(i,function(e){return e instanceof Object?c(t[r]||{},e):e}):typeof i!==h||null===i||f(i)?t[r]=i:t[r]=c(t[r]||{},i))}),t):n}function e(n,i){if(!this||this===t)return new e(n,i);var c={mapping:i||{},callbacks:{},deferred:[],ready:!1,instance:this};return a(this,n,c),c.ready=!0,c.deferred.length&&r(c.deferred,function(e){e()}),this}if(!Function.bind||!Object.defineProperty)throw new Error("Prerequisite APIs not available.");var o,l=!1;try{o=document.querySelectorAll.bind(document)}catch(s){}var u=[],f=Array.isArray,h="object",p=function(e){return e},d=function(e){return function(){try{return e.apply(this,arguments)}catch(t){console.error(t.stack?t.stack:t)}}};return i.prototype=[],e.prototype.__export=function(){return c({},this)},e}(this);"undefined"!=typeof exports&&(module.exports=Bind);